openapi: 3.0.3
info:
  title: Next-Go API
  version: 1.0.0
  description: Go API for Next.js monorepo template

servers:
  - url: http://localhost:8080
    description: Local development

paths:
  /ping:
    get:
      summary: Health check
      operationId: ping
      tags: [Health]
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PingResponse"

  /auth/signup:
    post:
      summary: Create new user
      operationId: signup
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SignupRequest"
      responses:
        "201":
          description: User created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/BadRequest"
        "409":
          $ref: "#/components/responses/Conflict"

  /auth/login:
    post:
      summary: Login with email and password
      operationId: login
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /auth/oauth/callback:
    post:
      summary: OAuth callback from provider
      operationId: oauthCallback
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OAuthCallbackRequest"
      responses:
        "200":
          description: Existing user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OAuthCallbackResponse"
        "201":
          description: New user created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OAuthCallbackResponse"
        "400":
          $ref: "#/components/responses/BadRequest"

  /auth/me:
    get:
      summary: Get current user
      operationId: getMe
      tags: [Auth]
      security:
        - bearerAuth: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /users:
    get:
      summary: List all users
      operationId: listUsers
      tags: [Users]
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      required: [id, email, created_at]
      properties:
        id:
          type: integer
          format: int64
        email:
          type: string
          format: email
        name:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time

    SignupRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
          maxLength: 72

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    LoginResponse:
      type: object
      required: [token, user]
      properties:
        token:
          type: string
        user:
          $ref: "#/components/schemas/User"

    OAuthCallbackRequest:
      type: object
      required: [provider, provider_account_id, email]
      properties:
        provider:
          type: string
        provider_account_id:
          type: string
        email:
          type: string
          format: email
        name:
          type: string

    OAuthCallbackResponse:
      type: object
      required: [user, is_new_user]
      properties:
        user:
          $ref: "#/components/schemas/User"
        is_new_user:
          type: boolean

    PingResponse:
      type: object
      required: [message]
      properties:
        message:
          type: string

    ErrorResponse:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
        message:
          type: string

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
